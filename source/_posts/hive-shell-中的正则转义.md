---
title: hive shell 中的正则转义
date: 2020-11-22 10:41:59
updated: 2020-11-22 10:41:59
tags:
  - Hive
comments: true
---
{% cq %}

当hive中遇到正则表达式且需要转义的坑

{% endcq %}

<!-- more -->

<br>

当正则中有只有\的情况时
转义字符\第一个功能--使特殊功能字符作为普通字符处理。
因为Java里面没有\单个普通字符，只有转义字符\，java见到\就会最高优先级先转义，所以如果一定要出现\的普通字符，必须用\\来先转个义,PS:String b ="\t";是合法的，这体现了转义符的第二个功能--使普通字符转化为特殊功能字符，虽然是两个字母位，但神奇地代表一个特殊功能字符即tab键，

String b ="\|"; 是不合法的，我开始想java把\|优先级先转义不就是|吗？为什么不合法，后来想，如果想要表达|普通符号的意思，String b ="|";就可以而且是合法的，所以String b ="\|"只能是想表达两个普通符号的意思，而\作为普通符号是不合法的，所以需要\\才有普通符号\。hive是java编写的是一样的。String.split要求入参是正则，当|是需要被匹配的分隔符时，直接split("|")里的入参|不符合入参是匹配|分隔符的正则表达式要求（它会解释成另外的意思即操作符或者），必须得是\|才行，而最后要达到split("\|")得有\\让java转义成一个\，因此这种情况是split("\\|")，PS：这里我开始想的是split("\\\|")，因为在java阶段转义\\变成\，\|变成\，然后是split入参正则阶段，但是我忘记了只有\才需要被多加一个\，String[] a =line.split("|")是被允许的，而String[] a =line.split("\")是不被允许的，因为java里面没有普通字符\，只有转义字符\，看到\就会最高优先级先转义，所以|并不一定要被强制在java阶段转一道义，它直接过渡到split入参阶段一样是合法的正则表达式（无论是表达|分隔符的正则表达式还是|操作符或者的正则表达式，总之是合法的）;

而当\是需要被匹配的分隔符时，得split("\\\\"),java阶段让第一个第二个变成\，第三个第四个变成\，然后\\当做正则入参传给split。hive语句在shell中执行相当于先shell转义，再java转义，最后split入参要求是合规的正则表达式，当|是需要被匹配的分隔符时，得是split("\\\\|")让在shell阶段第一个第二个变成\，第三个第四个变成\，然后java阶段\\变成一个\，最后传给split是\

